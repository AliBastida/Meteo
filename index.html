<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quiz Meteorolog√≠a Aeron√°utica ‚Äî PRO (hasta Frentes excl.)</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#0b1020;
    --accent:#60a5fa;
    --ok:#22c55e;
    --bad:#ef4444;
    --muted:#9ca3af;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 15% 10%, #1f2937 0%, var(--bg) 40%) fixed,
                radial-gradient(900px 600px at 85% 90%, #111827 0%, var(--bg) 50%) fixed;
    color:#e5e7eb; display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .wrap{width:min(980px,100%);}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px}
  .title{font-weight:700; letter-spacing:.3px; font-size: clamp(18px, 3vw, 22px); display:flex; gap:10px; align-items:center}
  .sub{color:var(--muted); font-size:12px}
  .pill{display:inline-flex; align-items:center; gap:8px; border:1px solid #334155; padding:6px 10px; border-radius:999px; color:#cbd5e1; background:#0b1220}
  .card{
    background:linear-gradient(180deg,var(--card),#0b1020f2), radial-gradient(600px 300px at 80% -20%, #1d2a44 0%, transparent 50%);
    border:1px solid #1f2a44; border-radius:18px; padding:20px; box-shadow: 0 30px 80px #0008;
  }
  .qtext{font-size: clamp(18px, 2.6vw, 22px); line-height:1.35; margin:0 0 18px}
  .meta{display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px}
  .choices{display:grid; gap:10px}
  .btn{
    width:100%; text-align:left; padding:14px 16px; border-radius:12px; border:1px solid #23314f;
    background:#0b1220; color:#e5e7eb; font-size:16px; cursor:pointer; transition: transform .05s ease, background .2s ease;
  }
  .btn:hover{transform: translateY(-1px)}
  .btn.correct{border-color:#1b4d2a; background: #06240f}
  .btn.wrong{border-color:#5c1a1a; background:#240606}
  .controls{display:flex; align-items:center; justify-content:space-between; margin-top:14px; gap:10px; flex-wrap:wrap}
  .progress{height:8px; background:#0b1220; border:1px solid #1f2a44; border-radius:999px; overflow:hidden; flex:1}
  .bar{height:100%; width:0%; background: linear-gradient(90deg,var(--accent),#34d399)}
  .muted{color:#cbd5e1b0}
  .tag{font-family:ui-monospace,SFMono-Regular,Menlo,monospace; font-size:12px; border:1px solid #334155; padding:2px 8px; border-radius:999px; color:#cbd5e1;}
  .result{display:none; text-align:center; gap:8px}
  .result.show{display:grid}
  .result h2{margin:0 0 6px}
  .result p{margin:0 0 14px; color:#cbd5e1}
  .ghost{background:transparent; border:1px dashed #334155; color:#cbd5e1}
  .footer{margin-top:10px; display:flex; justify-content:space-between; font-size:12px; color:#9ca3af; gap:8px; flex-wrap:wrap}
  .blink{animation: blink .8s linear infinite alternate}
  .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .timer{display:flex; align-items:center; gap:8px}
  .pie{width:38px; height:38px; border-radius:50%; background:conic-gradient(#34d399 0deg, #1f2a44 0deg); display:grid; place-items:center; font-size:12px; border:1px solid #1f2a44}
  input[type=range]{accent-color:#60a5fa}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace; border:1px solid #334155; padding:0 6px; border-radius:6px; font-size:12px}
  .board{border:1px solid #334155; border-radius:12px; padding:10px; background:#0b1220}
  .board h3{margin:0 0 6px; font-size:14px}
  .board ol{margin:0; padding-left:18px}
  .right{display:flex; gap:10px; align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">Quiz Meteo ‚Äî <span class="sub">hasta Frentes (excl.)</span></div>
    <div class="row">
      <div class="pill">
        <span id="status">Pregunta <b id="n">1</b>/<b id="tot">‚Äî</b></span>
        <span class="tag" id="streak">racha: 0</span>
      </div>
      <div class="pill row">
        <label class="muted">Tiempo por pregunta</label>
        <input type="range" id="secRange" min="5" max="60" value="20">
        <span class="tag" id="secLabel">20s</span>
      </div>
      <div class="pill row">
        <label class="muted">Sonido</label>
        <input type="checkbox" id="soundToggle" checked>
      </div>
    </div>
  </header>

  <div class="card" id="card">
    <div class="meta">
      <span class="tag" id="topic">Tema</span>
      <span class="tag" id="difficulty">Nivel</span>
      <span class="tag" id="globalTime">00:00</span>
      <span class="tag" title="Tiempo restante por pregunta"><span class="timer"><span class="pie" id="pie">20</span></span></span>
    </div>
    <h1 class="qtext" id="qtext">Cargando‚Ä¶</h1>
    <div class="choices" id="choices"></div>
    <div class="controls">
      <div class="progress"><div class="bar" id="bar"></div></div>
      <div class="right">
        <button id="skip" class="btn ghost" title="Cambiar orden (no penaliza)">Cambiar orden</button>
        <button id="pause" class="btn ghost" title="Pausar (P)"><span id="pstate">Pausar</span></button>
      </div>
    </div>

    <div id="result" class="result">
      <h2 id="resTitle">¬°Correcto!</h2>
      <p id="resMsg"></p>
      <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap">
        <button class="btn" id="again">Reiniciar con nuevas preguntas</button>
        <button class="btn ghost" id="showAnswers">Ver listado de preguntas</button>
      </div>
      <div class="row" style="justify-content:center; margin-top:8px">
        <div class="board" id="board">
          <h3>üèÜ Mejores marcas (este navegador)</h3>
          <ol id="bestList"></ol>
        </div>
      </div>
    </div>

    <div class="footer">
      <span>Basado en el temario: Tema 4 ‚Äî Meteorolog√≠a aeron√°utica (1. Introducci√≥n ‚Üí 5.2 Masas de aire). </span>
      <span id="footRight">Modo examen PRO ‚Ä¢ Timer + Sonidos + Marcador</span>
    </div>
  </div>
</div>

<script>
// Simple SFX with WebAudio
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();
let soundOn = true;
function beep(type='ok'){
  if(!soundOn) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.type = 'sine';
  if(type==='ok'){ o.frequency.value = 880; } // A5
  else if(type==='bad'){ o.frequency.value = 180; }
  else { o.frequency.value = 440; }
  g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(type==='ok'?0.12:0.18, audioCtx.currentTime+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+(type==='ok'?0.12:0.25));
  o.start();
  o.stop(audioCtx.currentTime+(type==='ok'?0.14:0.28));
}

// ======== Preguntas ========
const Q = [
  {q:"El 'tiempo' en meteorolog√≠a se refiere a‚Ä¶", a:["El promedio clim√°tico de 30 a√±os","Las condiciones actuales y su evoluci√≥n a corto plazo","La variaci√≥n estacional"], c:1, t:"1. Introducci√≥n", d:1},
  {q:"El 'clima' se define mejor como‚Ä¶", a:["Promedio de las condiciones atmosf√©ricas en periodos largos","El estado actual de la atm√≥sfera","El registro de fen√≥menos extremos"], c:0, t:"1. Introducci√≥n", d:1},
  {q:"La meteorolog√≠a aeron√°utica estudia‚Ä¶", a:["Fen√≥menos y variables que afectan operaciones de aeronaves en tierra y vuelo","Solo vientos en altura","√önicamente fen√≥menos de tormenta"], c:0, t:"1.2 Met. Aeron√°utica", d:1},
  {q:"Objetivo del Servicio Meteorol√≥gico (Anexo 3 OACI):", a:["Maximizar el n√∫mero de vuelos","Contribuir a la seguridad, regularidad y eficiencia","Priorizar la puntualidad sobre la seguridad"], c:1, t:"1.2 Met. Aeron√°utica", d:1},
  {q:"Usuarios del Servicio Meteorol√≥gico aeron√°utico incluyen‚Ä¶", a:["Exclusivamente tripulaciones","Operadores, tripulaciones, ATS, SAR y gestores de aeropuertos","Solo ATC y pilotos"], c:1, t:"1.2 Met. Aeron√°utica", d:2},
  {q:"¬øCu√°ntos WAFC existen a nivel mundial?", a:["Dos: Londres y Washington","Cinco repartidos por continentes","Uno centralizado en Ginebra"], c:0, t:"1.3 WAFC", d:1},
  {q:"Los WAFC proporcionan principalmente‚Ä¶", a:["Pron√≥sticos globales en ruta (viento, temperatura, fen√≥menos significativos)","METAR de aer√≥dromos","Im√°genes radar locales"], c:0, t:"1.3 WAFC", d:1},
  {q:"En caso de fallo de un WAFC‚Ä¶", a:["Se detiene la distribuci√≥n de productos","El otro WAFC asume sus funciones","Interviene una OMA"], c:1, t:"1.3 WAFC", d:1},
  {q:"Los VAAC emiten avisos sobre‚Ä¶", a:["Tornados","Cenizas volc√°nicas (extensi√≥n y movimiento)","Microrreventones"], c:1, t:"1.3 VAAC", d:1},
  {q:"Los TCAC informan de‚Ä¶", a:["Ciclones tropicales: posici√≥n, trayectoria, presi√≥n y vientos","Nubes noctilucentes","√çndices de radiaci√≥n UV"], c:0, t:"1.3 TCAC", d:1},
  {q:"Los CMRE proporcionan a WAFC‚Ä¶", a:["Pron√≥sticos de radiaci√≥n espacial","Informaci√≥n sobre liberaciones accidentales de materiales radiactivos y su evoluci√≥n","Observaciones METAR"], c:1, t:"1.3 CMRE", d:2},
  {q:"¬øQu√© vigilan las OVM (Espa√±a)?", a:["FIR Madrid/Barcelona y FIR Canarias","Un √∫nico aeropuerto por OVM","Solo aerov√≠as oce√°nicas"], c:0, t:"1.3 OVM", d:1},
  {q:"Funci√≥n clave de una OVM:", a:["Emitir TAF de aer√≥dromo","Vigilancia continua en FIR y difusi√≥n de avisos en ruta","Controlar radares de superficie"], c:1, t:"1.3 OVM", d:1},
  {q:"Una OMA es responsable de‚Ä¶", a:["Observaciones y vigilancia en el aer√≥dromo designado, consultas y documentaci√≥n de vuelo","Emitir SIGWX","Coordinar SAR"], c:0, t:"1.3 OMA", d:1},
  {q:"Una OMPA en Espa√±a prepara‚Ä¶", a:["Pron√≥sticos de aer√≥dromo (TAF 9/24/30 h) y TREND, y vigila su zona 24/7","√önicamente SPECI","Solo informaci√≥n clim√°tica hist√≥rica"], c:0, t:"1.3 OMPA", d:1},
  {q:"¬øQu√© elaboran y difunden las Estaciones Meteorol√≥gicas Aeron√°uticas?", a:["Observaciones ordinarias y especiales (p.ej. cada 30 min)","Predicciones estacionales","Boletines NOTAM"], c:0, t:"1.3 Estaciones", d:1},
  {q:"La OMM promueve especialmente‚Ä¶", a:["Normalizaci√≥n y r√°pido intercambio de datos entre servicios","Competencia comercial entre Estados","Privatizaci√≥n total del servicio"], c:0, t:"1.3 OMM", d:1},
  {q:"En Espa√±a, n√∫mero aproximado de OMA y OMD abiertas al tr√°fico civil:", a:["41 OMA y 7 OMD","10 OMA y 2 OMD","60 OMA y 0 OMD"], c:0, t:"1.3 OMA/OMD", d:2},
  {q:"Ubicaciones de las OMPA en Espa√±a:", a:["Madrid, Santander, Sevilla, Valencia y Las Palmas","Madrid, Barcelona, Bilbao","Sevilla, M√°laga, Palma, Vigo, Oviedo"], c:0, t:"1.3 OMPA", d:2},
  {q:"Composici√≥n mayoritaria del aire seco:", a:["N‚ÇÇ ~78%, O‚ÇÇ ~21% y otros","O‚ÇÇ ~78%, N‚ÇÇ ~21%","CO‚ÇÇ ~10%, N‚ÇÇ ~60%"], c:0, t:"2.1 Composici√≥n", d:1},
  {q:"El vapor de agua en la atm√≥sfera var√≠a t√≠picamente entre:", a:["0‚Äì0.05%","0.2‚Äì3%","5‚Äì10%"], c:1, t:"2.1 Composici√≥n", d:2},
  {q:"Aire 'h√∫medo' significa:", a:["Mayor contenido de vapor de agua","Mayor CO‚ÇÇ","Mayor ozono"], c:0, t:"2.1 Composici√≥n", d:1},
  {q:"La presi√≥n atmosf√©rica es:", a:["Peso del aire por unidad de superficie","Densidad del aire por unidad de volumen","Temperatura por unidad de masa"], c:0, t:"2.2.1 Presi√≥n", d:1},
  {q:"Unidades equivalentes est√°ndar a nivel del mar:", a:["1 atm = 760 mmHg = 1013.25 hPa","1 atm = 700 mmHg = 1000 hPa","1 atm = 29.92 mmHg = 1013.25 Pa"], c:0, t:"2.2.1 Presi√≥n", d:1},
  {q:"Con la altura, la presi√≥n‚Ä¶", a:["Aumenta","Disminuye","Permanece constante"], c:1, t:"2.2.1 Presi√≥n", d:1},
  {q:"Temperaturas m√°s altas en superficie tienden a‚Ä¶", a:["Aumentar la presi√≥n por aire m√°s denso","Disminuir la presi√≥n por ascenso del aire","No afectan a la presi√≥n"], c:1, t:"2.2.1 Presi√≥n", d:2},
  {q:"La temperatura es proporcional a‚Ä¶", a:["La energ√≠a interna asociada al movimiento molecular","La presi√≥n est√°tica","La humedad espec√≠fica"], c:0, t:"2.2.2 Temperatura", d:1},
  {q:"Punto de fusi√≥n del hielo en ¬∞C / K:", a:["0 ¬∞C / 273.16 K","0 ¬∞C / 273.00 K","-1 ¬∞C / 272.16 K"], c:0, t:"2.2.2 Temperatura", d:2},
  {q:"M√°ximos y m√≠nimos diarios suelen darse‚Ä¶", a:["Ambos a mediod√≠a","M√°ximo ~2h despu√©s del mediod√≠a; m√≠nimo poco despu√©s del amanecer","M√≠nimo a medianoche, m√°ximo al amanecer"], c:1, t:"2.2.2 Temperatura", d:2},
  {q:"Efecto de la nubosidad en la amplitud t√©rmica diaria:", a:["La incrementa","La reduce (suaviza m√°ximos/m√≠nimos)","No influye"], c:1, t:"2.2.2 Temperatura", d:1},
  {q:"Superficie terrestre vs. marina respecto a variaci√≥n diaria de temperatura:", a:["Tierra var√≠a m√°s que el mar","Mar var√≠a m√°s que la tierra","Igual variaci√≥n"], c:0, t:"2.2.2 Temperatura", d:1},
  {q:"Gradiente t√©rmico vertical positivo significa:", a:["Temperatura disminuye con la altura (lo normal)","Temperatura aumenta con la altura","Temperatura constante"], c:0, t:"2.2.2 Temperatura", d:2},
  {q:"Una inversi√≥n t√©rmica corresponde a:", a:["Tramo donde la temperatura aumenta con la altura","Tramo isoterma","Tramo de enfriamiento adiab√°tico"], c:0, t:"2.2.2 Temperatura", d:2},
  {q:"Humedad relativa es‚Ä¶", a:["Relaci√≥n (%) entre vapor real y vapor a saturaci√≥n a esa temperatura","Cantidad absoluta de vapor de agua","Presi√≥n de vapor saturado"], c:0, t:"2.2.3 Humedad", d:1},
  {q:"Punto de roc√≠o:", a:["Temperatura para saturar el aire sin a√±adir agua","Temperatura del bulbo h√∫medo","Temperatura de ebullici√≥n"], c:0, t:"2.2.3 Humedad", d:1},
  {q:"A mayor temperatura del aire, su capacidad para contener vapor de agua‚Ä¶", a:["Disminuye","Aumenta","No cambia"], c:1, t:"2.2.3 Humedad", d:1},
  {q:"Solo ~¬øqu√© porcentaje? de la radiaci√≥n solar alcanza la superficie:", a:["40%","60%","80%"], c:0, t:"2.2.4 Radiaci√≥n", d:2},
  {q:"La radiaci√≥n solar se mide en:", a:["W/m¬≤","J/kg","K¬∑Pa"], c:0, t:"2.2.4 Radiaci√≥n", d:1},
  {q:"El albedo alto (nieve/hielo)‚Ä¶", a:["Aumenta la absorci√≥n","Aumenta la reflectividad y reduce la radiaci√≥n absorbida","No tiene efecto"], c:1, t:"2.2.4 Radiaci√≥n", d:2},
  {q:"Con la altitud, la radiaci√≥n‚Ä¶", a:["Tiende a aumentar (~10% por km)","Disminuye","Permanece constante"], c:0, t:"2.2.4 Radiaci√≥n", d:2},
  {q:"El aerosol atmosf√©rico puede‚Ä¶", a:["Dispersar/absorber radiaci√≥n y actuar como n√∫cleos de condensaci√≥n","Solo calentar la troposfera","No tiene efecto"], c:0, t:"2.2.4 Radiaci√≥n", d:3},
  {q:"La troposfera se extiende aproximadamente hasta:", a:["8 km en latitudes altas y ~18 km en bajas","20 km en todas las latitudes","50 km en latitudes medias"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"En la troposfera la temperatura‚Ä¶", a:["Aumenta con la altura","Desciende con la altura","Permanece constante"], c:1, t:"2.2.5 Estructura", d:1},
  {q:"La tropopausa se caracteriza por‚Ä¶", a:["Temperatura aprox. constante (~ -56 ¬∞C)","Un m√°ximo de vapor de agua","Presencia del ozono m√°ximo"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"La mayor√≠a de fen√≥menos meteorol√≥gicos ocurren en:", a:["Estratosfera","Mesosfera","Troposfera"], c:2, t:"2.2.5 Estructura", d:1},
  {q:"En la estratosfera la temperatura:", a:["Aumenta con la altura (por ozono)","Disminuye linealmente","Es isoterma"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"La mesopausa es:", a:["L√≠mite superior de la mesosfera; zona m√°s fr√≠a","L√≠mite inferior de la estratosfera","Zona de mayor ozono"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"La ionosfera (termosfera) destaca por:", a:["Alta ionizaci√≥n y reflexi√≥n de ondas de radio","Abundante vapor de agua","Formaci√≥n de cumulonimbos"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"La homosfera comprende:", a:["Troposfera, estratosfera y mesosfera","Solo troposfera y estratosfera","Estratosfera y termosfera"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"La tropopausa no es continua globalmente y en sus roturas se originan:", a:["Cumulonimbos","Corrientes en chorro","Nimbostratos"], c:1, t:"2.2.5 Estructura", d:2},
  {q:"Nubes nacaradas se observan a 20‚Äì30 km en:", a:["Estratosfera","Mesosfera","Troposfera"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"Nubes noctilucentes se observan en latitudes altas en:", a:["Mesosfera","Estratosfera","Ionosfera"], c:0, t:"2.2.5 Estructura", d:3},
  {q:"La presi√≥n en la estratopausa es aproximadamente:", a:["Similar a nivel del mar","~0.1% de la presi√≥n a nivel del mar","El doble que a nivel del mar"], c:1, t:"2.2.5 Estructura", d:3},
  {q:"En latitudes medias, altura media de la tropopausa:", a:["~12 km","~5 km","~25 km"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"La principal fuente de calor del sistema Tierra-atm√≥sfera es:", a:["La radiactividad terrestre","El Sol","El n√∫cleo terrestre"], c:1, t:"3. Intercambio de calor", d:1},
  {q:"Transferencia de calor por contacto:", a:["Convecci√≥n","Conducci√≥n","Radiaci√≥n"], c:1, t:"3. Intercambio de calor", d:1},
  {q:"Movimiento vertical de masas de aire que transporta calor:", a:["Convecci√≥n","Advecci√≥n","Turbulencia"], c:0, t:"3. Intercambio de calor", d:1},
  {q:"Movimiento horizontal de masas de aire:", a:["Convecci√≥n","Advecci√≥n","Conducci√≥n"], c:1, t:"3. Intercambio de calor", d:1},
  {q:"Turbulencia como transferencia de calor implica:", a:["Corrientes ordenadas y uniformes","Corrientes desordenadas con remolinos","Solo radiaci√≥n infrarroja"], c:1, t:"3. Intercambio de calor", d:2},
  {q:"La transferencia de calor va siempre de:", a:["Zonas fr√≠as a calientes","Zonas calientes a fr√≠as","No tiene direcci√≥n definida"], c:1, t:"3. Intercambio de calor", d:1},
  {q:"Corrientes de convecci√≥n y corrientes oce√°nicas ayudan a:", a:["Mantener equilibrio t√©rmico entre latitudes","Aumentar indefinidamente la T media","Disipar toda la humedad"], c:0, t:"3. Intercambio de calor", d:2},
  {q:"La circulaci√≥n general redistribuye:", a:["Humedad √∫nicamente","Calor sobre la superficie del planeta","Salinidad oce√°nica"], c:1, t:"4.1 Circ. general", d:1},
  {q:"C√©lulas principales de circulaci√≥n:", a:["Polar, Ferrel, Hadley","Ecuatorial, Tropical, Boreal","Hadley √∫nica global"], c:0, t:"4.1 Circ. general", d:1},
  {q:"La c√©lula de Hadley se ubica entre:", a:["0¬∞‚Äì30¬∞","30¬∞‚Äì60¬∞","60¬∞‚Äì90¬∞"], c:0, t:"4.1 Circ. general", d:1},
  {q:"La c√©lula Polar genera predominantemente:", a:["Vientos del Este polares","Vientos alisios","Vientos del Oeste"], c:0, t:"4.1 Circ. general", d:2},
  {q:"La c√©lula de Ferrel origina:", a:["Vientos del Oeste en latitudes medias","Alisios","Vientos del Este"], c:0, t:"4.1 Circ. general", d:2},
  {q:"La fuerza de Coriolis en el hemisferio norte desv√≠a:", a:["Hacia la izquierda","Hacia la derecha","Hacia el ecuador"], c:1, t:"4.2 Coriolis", d:1},
  {q:"Este efecto de Coriolis es m√°s intenso en:", a:["El ecuador","Los polos","Es igual en todas partes"], c:0, t:"4.2 Coriolis", d:2},
  {q:"Causa principal del viento:", a:["Gradiente de presi√≥n","Fuerza centr√≠fuga","Fuerza de sustentaci√≥n"], c:0, t:"4.3 Viento", d:1},
  {q:"La direcci√≥n del viento se expresa seg√∫n:", a:["Hacia d√≥nde sopla","De d√≥nde procede, en grados desde el norte verdadero","√Ångulo respecto al sur magn√©tico"], c:1, t:"4.3 Viento", d:2},
  {q:"Unidades de intensidad de viento (comunes en aviaci√≥n):", a:["Nudos, m/s, km/h","Solo km/h","Solo nudos"], c:0, t:"4.3 Viento", d:1},
  {q:"Factores que influyen en el viento adem√°s del gradiente de presi√≥n:", a:["Gravedad, Coriolis, fuerza centr√≠fuga, rozamiento","√önicamente rozamiento","Solo gravedad"], c:0, t:"4.3 Viento", d:2},
  {q:"Vientos locales 'brisas' se deben principalmente a:", a:["Diferente calentamiento tierra-mar","Coriolis exclusivamente","Fuerza centr√≠fuga"], c:0, t:"4.3.2 Vientos locales", d:1},
  {q:"Durante el d√≠a, la brisa de mar sopla:", a:["De mar a tierra","De tierra a mar","Paralela a la costa"], c:0, t:"4.3.2 Vientos locales", d:1},
  {q:"Por la noche, la brisa de tierra sopla:", a:["De mar a tierra","De tierra a mar","No existe"], c:1, t:"4.3.2 Vientos locales", d:1},
  {q:"En el retorno en altura de la brisa diurna, el aire fluye:", a:["Tierra ‚Üí mar","Mar ‚Üí tierra","No hay retorno"], c:0, t:"4.3.2 Vientos locales", d:2},
  {q:"El efecto Foehn ocurre cuando:", a:["Una masa asciende, precipita en barlovento y desciende c√°lida y seca a sotavento","El aire fr√≠o desciende por barlovento enfriando m√°s","Se bloquea completamente el flujo"], c:0, t:"4.3.3 Foehn", d:2},
  {q:"Tiempo t√≠pico a sotavento bajo Foehn:", a:["H√∫medo y nublado","Despejado, m√°s c√°lido y seco","Tormentas intensas locales"], c:1, t:"4.3.3 Foehn", d:2},
  {q:"Un anticicl√≥n es:", a:["Regi√≥n de baja presi√≥n","Regi√≥n de alta presi√≥n respecto a alrededores","Un frente estacionario"], c:1, t:"5.1 Sistemas", d:1},
  {q:"Vientos en anticicl√≥n (Hem. Norte):", a:["Antihorarios y fuertes en el centro","Horarios, flojos en el centro","Horarios, fuertes en el centro"], c:1, t:"5.1 Sistemas", d:2},
  {q:"Tiempo t√≠pico bajo anticicl√≥n en verano:", a:["Inestable y lluvioso","Despejado y caluroso","Nevadas frecuentes"], c:1, t:"5.1 Sistemas", d:1},
  {q:"En invierno, los anticiclones pueden provocar:", a:["Inversiones t√©rmicas y nieblas","Ciclones tropicales","L√≠neas de turbonada"], c:0, t:"5.1 Sistemas", d:2},
  {q:"Una depresi√≥n (borrasca) es:", a:["Regi√≥n de baja presi√≥n; vientos fuertes en el centro","Regi√≥n de alta presi√≥n; vientos flojos en el centro","Zona de presi√≥n constante"], c:0, t:"5.1 Sistemas", d:1},
  {q:"Circulaci√≥n en depresi√≥n Hem. Norte:", a:["Antihoraria y hacia dentro","Horaria y hacia fuera","Horaria y hacia dentro"], c:0, t:"5.1 Sistemas", d:2},
  {q:"Tiempo asociado a depresiones:", a:["Estable, cielos despejados","Inestable, nubosidad y precipitaciones/tormentas","Solo viento en calma"], c:1, t:"5.1 Sistemas", d:1},
  {q:"Las masas de aire adquieren caracter√≠sticas por:", a:["Permanecer sobre su regi√≥n fuente (terrestre/mar√≠tima) el tiempo suficiente","Cruzar monta√±as r√°pidamente","Altas velocidades del jet"], c:0, t:"5.2 Masas de aire", d:2},
  {q:"Clasificaci√≥n latitudinal de masas de aire:", a:["√Årtica, Polar, Tropical, Ecuatorial","Polar, Templada, Tropical h√∫meda","Solo Tropical y Polar"], c:0, t:"5.2 Masas de aire", d:1},
  {q:"Una masa de aire 'seca' suele provenir de:", a:["Regi√≥n continental","Regi√≥n mar√≠tima","Regi√≥n ecuatorial"], c:0, t:"5.2 Masas de aire", d:1},
  {q:"Una masa de aire 'h√∫meda' suele provenir de:", a:["Regi√≥n continental","Regi√≥n mar√≠tima","Regi√≥n des√©rtica"], c:1, t:"5.2 Masas de aire", d:1},
  {q:"Al desplazarse desde su regi√≥n fuente, una masa de aire:", a:["Mantiene inmutables sus propiedades","Se modifica por condiciones de la superficie subyacente","Pierde toda su humedad inmediatamente"], c:1, t:"5.2 Masas de aire", d:2},
  {q:"La direcci√≥n del viento se mide respecto al:", a:["Norte verdadero (geogr√°fico)","Norte magn√©tico exclusivamente","Este geogr√°fico"], c:0, t:"4.3 Viento", d:2},
  {q:"Los WAFC integran en sus productos informaci√≥n de:", a:["VAAC y TCAC, y CMRE (radiactivos)","Solo OMA","√önicamente estaciones autom√°ticas"], c:0, t:"1.3 WAFC", d:2},
  {q:"Si una OMA detecta cambio importante de viento o visibilidad, debe emitir:", a:["SIGMET","SPECI/observaci√≥n especial","NOTAM"], c:1, t:"1.3 OMA/Estaciones", d:2},
  {q:"Una OMPA opera:", a:["Solo horario diurno","24 horas con medios avanzados","De lunes a viernes"], c:1, t:"1.3 OMPA", d:1},
  {q:"Con nubosidad abundante, los m√°ximos de temperatura diurnos:", a:["Suelen ser m√°s bajos","Son m√°s altos","No cambian"], c:0, t:"2.2.2 Temperatura", d:1},
  {q:"Radiaci√≥n solar nocturna a nivel del suelo:", a:["‚âà0 W/m¬≤","‚âà100 W/m¬≤","‚âà400 W/m¬≤"], c:0, t:"2.2.4 Radiaci√≥n", d:1},
  {q:"El viento transporta principalmente:", a:["Vapor de agua y calor","Ozono y CO‚ÇÇ","Sales marinas exclusivamente"], c:0, t:"4.3 Viento", d:1},
  {q:"En brisa nocturna (de tierra): en altura el retorno es:", a:["Mar ‚Üí tierra","Tierra ‚Üí mar","No hay retorno"], c:1, t:"4.3.2 Vientos locales", d:2},
  {q:"La intensidad del viento se expresa com√∫nmente en:", a:["Nudos (kt)","Lux","Calor√≠as"], c:0, t:"4.3 Viento", d:1},
  {q:"La fuerza centr√≠fuga y el rozamiento:", a:["Influyen en la direcci√≥n e intensidad reales del viento","No influyen en absoluto","Solo influyen sobre oc√©anos"], c:0, t:"4.3 Viento", d:2},
  {q:"En un anticicl√≥n del Hem. Sur, la circulaci√≥n es:", a:["Antihoraria","Horaria","Indefinida"], c:0, t:"5.1 Sistemas", d:2},
  {q:"El aire caliente es menos denso y tiende a:", a:["Ascender","Descender","Quedarse en superficie"], c:0, t:"2.2.1 Presi√≥n", d:1},
  {q:"Escalas de temperatura de referencia en el temario:", a:["Celsius, Kelvin y Fahrenheit","Solo Celsius y Kelvin","Solo Kelvin"], c:0, t:"2.2.2 Temperatura", d:1},
  {q:"El m√°ximo diario de temperatura suele ocurrir:", a:["Cerca de dos horas despu√©s del mediod√≠a","Exactamente al mediod√≠a","Al ponerse el sol"], c:0, t:"2.2.2 Temperatura", d:2},
  {q:"El m√≠nimo diario de temperatura suele ocurrir:", a:["A medianoche","Poco despu√©s del amanecer","A media tarde"], c:1, t:"2.2.2 Temperatura", d:2},
  {q:"La presi√≥n y densidad del aire con la altura:", a:["Aumentan","Disminuyen","Permancen constantes"], c:1, t:"2.2.5 Estructura", d:1},
  {q:"En la estratosfera el contenido de vapor de agua es:", a:["Peque√±o, casi no hay nubes","Muy alto","Id√©ntico a la troposfera"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"Los topes de cumulonimbos pueden:", a:["Penetrar ligeramente en la estratosfera por inercia","Llegar a la mesopausa con facilidad","No alcanzar la tropopausa"], c:0, t:"2.2.5 Estructura", d:3},
  {q:"La exosfera:", a:["Es la √∫ltima capa, se confunde con el gas interplanetario","Se encuentra entre 0 y 5 km","Es rica en vapor de agua"], c:0, t:"2.2.5 Estructura", d:2},
  {q:"Una regi√≥n fuente mar√≠tima tender√° a hacer a la masa de aire:", a:["M√°s h√∫meda","M√°s seca","M√°s fr√≠a siempre"], c:0, t:"5.2 Masas de aire", d:1},
  {q:"Una regi√≥n fuente fr√≠a har√° a la masa de aire:", a:["Tender a enfriarse","Aumentar humedad sin cambiar temperatura","Calentarse autom√°ticamente"], c:0, t:"5.2 Masas de aire", d:1},
  {q:"Los vientos del Oeste dominan:", a:["Latitudes medias (c√©lula de Ferrel)","Ecuador","Polos"], c:0, t:"4.1 Circ. general", d:2},
  {q:"Los alisios dominan:", a:["0¬∞‚Äì30¬∞ (c√©lula de Hadley)","30¬∞‚Äì60¬∞ (Ferrel)","60¬∞‚Äì90¬∞ (Polar)"], c:0, t:"4.1 Circ. general", d:2},
  {q:"Un anticicl√≥n suele traer en verano:", a:["Cielos despejados y poco movimiento atmosf√©rico","Nubosidad estratiforme con lluvia persistente","Vaguadas profundas con nieve"], c:0, t:"5.1 Sistemas", d:1},
  {q:"Una depresi√≥n suele asociarse a:", a:["Cielos despejados persistentes","Abundante nubosidad, lluvias/tormentas","Nieblas de irradiaci√≥n exclusivamente"], c:1, t:"5.1 Sistemas", d:1},
  {q:"¬øQu√© define la direcci√≥n del viento en grados?", a:["El √°ngulo desde el norte verdadero en sentido horario","El √°ngulo desde el este verdadero","El √°ngulo desde el norte magn√©tico siempre"], c:0, t:"4.3 Viento", d:2},
  {q:"El gradiente t√©rmico vertical negativo indica:", a:["Inversi√≥n","Enfriamiento con la altura m√°s fuerte de lo normal","Isotermia"], c:0, t:"2.2.2 Temperatura", d:2},
  {q:"Las brisas se originan por:", a:["Diferencias de calor espec√≠fico tierra/mar","Coriolis en altura","Fuerza centr√≠fuga"], c:0, t:"4.3.2 Vientos locales", d:2},
  {q:"En barlovento de una cordillera bajo Foehn se espera:", a:["Precipitaci√≥n y enfriamiento por ascenso","Aire seco y c√°lido","Nada destacable"], c:0, t:"4.3.3 Foehn", d:2},
  {q:"El sentido de circulaci√≥n en anticicl√≥n del Hem. Norte es:", a:["Horario","Antihorario","Lineal"], c:0, t:"5.1 Sistemas", d:1},
  {q:"En el centro de un anticicl√≥n, los vientos suelen ser:", a:["Flojos","Muy fuertes","Siempre nulos"], c:0, t:"5.1 Sistemas", d:1},
  {q:"En el centro de una depresi√≥n, los vientos suelen ser:", a:["Fuertes","Flojos","Id√©nticos al exterior"], c:0, t:"5.1 Sistemas", d:1}
];

// ======== Motor PRO ========
const totEl = document.getElementById('tot');
const nEl = document.getElementById('n');
const qEl = document.getElementById('qtext');
const choicesEl = document.getElementById('choices');
const topicEl = document.getElementById('topic');
const diffEl = document.getElementById('difficulty');
const barEl = document.getElementById('bar');
const streakEl = document.getElementById('streak');
const resBox = document.getElementById('result');
const resTitle = document.getElementById('resTitle');
const resMsg = document.getElementById('resMsg');
const againBtn = document.getElementById('again');
const showBtn = document.getElementById('showAnswers');
const skipBtn = document.getElementById('skip');
const pie = document.getElementById('pie');
const secRange = document.getElementById('secRange');
const secLabel = document.getElementById('secLabel');
const soundToggle = document.getElementById('soundToggle');
const globalTimeEl = document.getElementById('globalTime');
const pauseBtn = document.getElementById('pause');
const pstate = document.getElementById('pstate');
const bestList = document.getElementById('bestList');

let order = [];
let index = 0;
let streak = 0;
let perSec = 20;
let perTimer = null;
let perRemain = perSec;
let paused = false;
let startTime = null;
let globalTimer = null;

// Leaderboard (localStorage)
function loadBoard(){
  const data = JSON.parse(localStorage.getItem('meteo_quiz_board')||'[]');
  return data.sort((a,b)=> a.time-b.time).slice(0,10);
}
function saveBoard(entry){
  const b = loadBoard();
  b.push(entry);
  localStorage.setItem('meteo_quiz_board', JSON.stringify(b));
}
function renderBoard(){
  const b = loadBoard();
  bestList.innerHTML = b.length? b.map((r,i)=>`<li>#${i+1} ‚Äî ${r.name||'Alicia'} ¬∑ ${r.correct}/100 ¬∑ ${fmtTime(r.time)}</li>`).join('') : '<li>No hay marcas todav√≠a.</li>';
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function fmtTime(ms){
  const s = Math.floor(ms/1000);
  const m = Math.floor(s/60);
  const r = s%60;
  return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}`;
}

function prepare(){
  totEl.textContent = Q.length;
  order = shuffle([...Array(Q.length).keys()]);
  index = 0;
  streak = 0;
  streakEl.textContent = `racha: ${streak}`;
  resBox.classList.remove('show');
  barEl.style.width = '0%';
  perSec = Number(secRange.value);
  perRemain = perSec;
  secLabel.textContent = `${perSec}s`;
  paused = false; pstate.textContent = 'Pausar';
  startTime = Date.now();
  if(globalTimer) clearInterval(globalTimer);
  globalTimer = setInterval(()=>{
    if(!paused) globalTimeEl.textContent = fmtTime(Date.now() - startTime);
  }, 200);
  renderBoard();
  render();
}

function startPerTimer(){
  if(perTimer) clearInterval(perTimer);
  perRemain = perSec;
  updatePie();
  perTimer = setInterval(()=>{
    if(paused) return;
    perRemain -= 1;
    updatePie();
    if(perRemain<=0){
      clearInterval(perTimer);
      // Time out -> fail
      fail("‚è≥ Se acab√≥ el tiempo");
    }
  }, 1000);
}
function updatePie(){
  pie.textContent = perRemain;
  const deg = Math.max(0, (perRemain/perSec)*360);
  pie.style.background = `conic-gradient(#f59e0b ${360-deg}deg, #1f2a44 0deg)`;
}

function render(){
  const q = Q[order[index]];
  nEl.textContent = (index+1);
  qEl.textContent = q.q;
  topicEl.textContent = q.t;
  diffEl.textContent = ['Nivel 1','Nivel 2','Nivel 3'][q.d-1] || 'Nivel';
  choicesEl.innerHTML='';
  const opts = shuffle(q.a.map((txt,i)=>({txt, i})));
  opts.forEach(({txt,i})=>{
    const b = document.createElement('button');
    b.className='btn';
    b.textContent = txt;
    b.onclick = ()=>check(i === q.c, b, q, txt);
    choicesEl.appendChild(b);
  });
  barEl.style.width = `${(index/Q.length)*100}%`;
  startPerTimer();
}

function check(ok, btn, q, txt){
  document.querySelectorAll('.btn').forEach(b=>b.disabled=true);
  clearInterval(perTimer);
  if(ok){
    btn.classList.add('correct');
    beep('ok');
    streak++;
    streakEl.textContent = `racha: ${streak}`;
    setTimeout(()=>{
      index++;
      if(index>=Q.length){
        win();
      }else{
        render();
      }
    },220);
  }else{
    btn.classList.add('wrong');
    fail("Respuesta incorrecta");
  }
}

function fail(reason){
  beep('bad');
  streak = 0;
  streakEl.textContent = `racha: ${streak}`;
  resTitle.textContent = '¬°Fallaste! üòÖ';
  resMsg.innerHTML = `${reason}. Reiniciamos el juego con <b>nuevo orden</b> de preguntas y opciones.`;
  resBox.classList.add('show');
  clearInterval(globalTimer);
}

function win(){
  barEl.style.width = '100%';
  const t = Date.now() - startTime;
  resTitle.textContent = '¬°Perfecto!';
  resMsg.innerHTML = `Has completado las <b>${Q.length}</b> preguntas sin fallar en <b>${fmtTime(t)}</b>.<br>Tu marca se guardar√° en este navegador.`;
  resBox.classList.add('show');
  saveBoard({name:'Alicia', time:t, correct:Q.length, date:Date.now()});
  renderBoard();
  clearInterval(globalTimer);
}

function downloadAll(){
  const lines = Q.map((q,i)=>`${i+1}. ${q.q}  [A] ${q.a[0]}  [B] ${q.a[1]}  [C] ${q.a[2]}  ‚Üí correcta: ${['A','B','C'][q.c]}`);
  const blob = new Blob([lines.join('\n')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download='Preguntas_Meteo_Avion_100.txt';
  a.click();
  URL.revokeObjectURL(url);
}

// UI events
againBtn.onclick = ()=>prepare();
skipBtn.onclick = ()=>{ order = shuffle(order); render(); };
showBtn.onclick = downloadAll;
secRange.oninput = ()=>{ secLabel.textContent = `${secRange.value}s`; perSec = Number(secRange.value); perRemain = perSec; updatePie(); };
soundToggle.onchange = ()=>{ soundOn = soundToggle.checked; if(soundOn) beep('ok'); };
pauseBtn.onclick = ()=>{
  paused = !paused;
  pstate.textContent = paused ? 'Reanudar' : 'Pausar';
};

// Teclas r√°pidas
document.addEventListener('keydown',(e)=>{
  if(e.key.toLowerCase()==='p'){ pauseBtn.click(); }
  if(e.key===' '){ e.preventDefault(); skipBtn.click(); }
});

// Go!
prepare();
</script>
</body>
</html>
